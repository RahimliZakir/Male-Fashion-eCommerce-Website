@model ShopViewModel

@{
    ViewData["Title"] = "Shop";
}

<section class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__text">
                    <h4>Shop</h4>
                    <div class="breadcrumb__links">
                        <a href="index-2.html">Home</a>
                        <span>Shop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="shop spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="shop__sidebar">
                    <div class="shop__sidebar__search">
                        <form asp-action="Index" asp-controller="Shop">
                            <input type="text" name="searchShop" placeholder="Search..." />
                            <button type="submit">
                                <span class="icon_search"></span>
                            </button>
                        </form>
                    </div>
                    <div class="shop__sidebar__accordion">
                        <div class="accordion" id="accordionExample">
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseOne">Categories</a>
                                </div>
                                <div id="collapseOne"
                                     class="collapse show"
                                     data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__categories">
                                            <ul class="nice-scroll">
                                                @foreach (Category item in Model.Categories)
                                                {
                                                    <li><a asp-action="Index" asp-controller="Shop" asp-route-category="@item.Name">@item.Name</a></li>
                                                }
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseTwo">Branding</a>
                                </div>
                                <div id="collapseTwo"
                                     class="collapse show"
                                     data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__brand">
                                            <ul>
                                                @foreach (Brand item in Model.Brands)
                                                {
                                                    <li><a asp-action="Index" asp-controller="Shop" asp-route-brandName="@item.BrandName">@item.BrandName</a></li>
                                                }
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseThree">Filter Price</a>
                                </div>
                                <div id="collapseThree"
                                     class="collapse show"
                                     data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__price">
                                            <form asp-action="Index">
                                                <input class="d-inline-block w-100" min="0" max="150" type="range" name="max" id="sop-range" />
                                                <label class="d-flex align-content-center justify-content-between" for="sop-range">0 <strong>-</strong> <span></span></label>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseFour">Size</a>
                                </div>
                                <div id="collapseFour"
                                     class="collapse show"
                                     data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__size">
                                            <form asp-action="Index" asp-controller="Shop">
                                                @foreach (Size item in Model.Sizes)
                                                {
                                                    <label class="size-namew">
                                                        @item.SizeName
                                                        <input type="radio" name="size" class="size-radio" value="@item.SizeName">
                                                    </label>
                                                }
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseFive">Colors</a>
                                </div>
                                <div id="collapseFive"
                                     class="collapse show"
                                     data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__color">
                                            <form asp-action="Index" asp-controller="Shop">
                                                @foreach (Color item in Model.Colors)
                                                {
                                                    <label class="c-1" style="background-color: @item.ColorName;">
                                                        <input type="radio" name="color" class="color-radio" value="@item.ColorName" />
                                                    </label>
                                                }
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseSix">Tags</a>
                                </div>
                                <div id="collapseSix"
                                     class="collapse show"
                                     data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__tags">
                                            <form asp-action="Index" asp-controller="Shop">
                                                @foreach (ProductTag item in Model.ProductTags)
                                                {
                                                    <a asp-action="Index" asp-controller="Shop" asp-route-productTag="@item.ProductTagName">@item.ProductTagName</a>
                                                }
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="shop__product__option">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__left">
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__right">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    @foreach (DiscountProductViewModel item in Model.DiscountProductViewModel)
                    {
                        <div class="col-lg-4 col-md-6 col-sm-6">
                            <div class="product__item">
                                <div class="product__item__pic set-bg" data-setbg="assets/images/shop/@item.ProductImages.FirstOrDefault(pi => pi.IsMain).ImagePath">
                                    @if (item.CampaignTitle != null && item.Discount != null)
                                    {
                                        <span class="label" style="background-color: red;">@((int)item.Discount)% @item.CampaignTitle</span>
                                    }
                                </div>
                                <div class="product__item__text">
                                    <h6>@item.Title.EllipseText(50)</h6>
                                    <a style="cursor: pointer;" class="add-cart" data-id="@item.Id">+ Add To Cart</a>
                                    @if (item.PriceNew != null)
                                    {
                                        <h5 class="price-product" style="text-decoration: line-through; color: grey;">$@item.Price</h5>
                                        <h5 class="pricenew-product">$@item.PriceNew</h5>
                                        <a style="position: static; visibility: visible; opacity: 1;" asp-action="Index" asp-controller="ShopDetails" asp-route-id="@item.Id" class="badge bg-warning text-dark">Ətraflı</a>
                                    }
                                    else
                                    {
                                        <h5 class="price-product">$@item.Price</h5>
                                        <a style="position: static; visibility: visible; opacity: 1;" asp-action="Index" asp-controller="ShopDetails" asp-route-id="@item.Id" class="badge bg-warning text-dark">Ətraflı</a>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

@section scripts{
    <script src="libs/jquery-cookie/jquery.cookie.min.js"></script>
    <script>
        let value = $('#sop-range').val();
        $('#sop-range').next('label').find('span').text(value);
        $('#sop-range').on('input', (e) => {
            let value = $(e.currentTarget).val();
            $(e.currentTarget).next('label').find('span').text(value);
        });

        $('#sop-range').change((e) => {
            $(e.currentTarget).closest('form').trigger('submit');
        });

        $('.color-radio').change(function () {
            $(this).parent().parent().submit();
        });

        $('.size-namew').click(function () {
            $(this).find('input').trigger("change");
            $(this).parent().submit();
        });

        //Basket Logic
        //if (sessionStorage.getItem('bag').split(',').length <= 9) {
        //    $('.header__nav__option span').text(sessionStorage.getItem('bag').split(',').length);
        //} else {
        //    $('.header__nav__option span').text('9+');
        //}

        $('.add-cart').click(function (e) {
            let basket = $('.header__nav__option span');
            let price = $('.price');

            let data = $(e.currentTarget).data('id');

            let bags = sessionStorage.getItem('bag');

            if (bags == null) {
                bags = [];
            }
            else {
                bags = bags.split(',').map(v => parseInt(v));
            }

            //if (bags.find((item) => item == data) != null) {
            //    alert("Bu məhsul artıq səbətdə var!");
            //}
            //else {
            bags.push(data);
            //}

            sessionStorage.setItem('bag', bags.toString());

            if (bags.length <= 9) {
                $(basket).text(bags.length);
            } else {
                $(basket).text('9+');
            }

            let priceNewProduct = $('.pricenew-product');
            let priceProduct = $('.price-product');

            let parsedPriceBoxVal = parseFloat($(price).text().replace("$", ""));

            if (priceNewProduct != null) {
                let value = $(priceNewProduct).text().replace("$", "");
                $(price).text(parsedPriceBoxVal + parseFloat(value));
            }
            else {
                let value = $(priceProduct).text().replace("$", "");
                $(price).text(parsedPriceBoxVal + parseFloat(value));
            }
        });
    </script>
}